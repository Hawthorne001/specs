<!DOCTYPE HTML>
<html lang="en" class="ayu" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Token Bridging - OP Stack Specification</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('ayu')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../root.html"><strong aria-hidden="true">1.</strong> Root</a></li><li class="chapter-item expanded "><a href="../background.html"><strong aria-hidden="true">2.</strong> Background</a></li><li class="chapter-item expanded "><a href="../protocol/overview.html"><strong aria-hidden="true">3.</strong> OP Stack Protocol</a></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">3.1.</strong> Network Upgrades</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../protocol/regolith/overview.html"><strong aria-hidden="true">3.1.1.</strong> Regolith</a></li><li class="chapter-item expanded "><a href="../protocol/canyon/overview.html"><strong aria-hidden="true">3.1.2.</strong> Canyon</a></li><li class="chapter-item expanded "><a href="../protocol/delta/overview.html"><strong aria-hidden="true">3.1.3.</strong> Delta</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../protocol/delta/span-batches.html"><strong aria-hidden="true">3.1.3.1.</strong> Span Batches</a></li></ol></li><li class="chapter-item expanded "><a href="../protocol/ecotone/overview.html"><strong aria-hidden="true">3.1.4.</strong> Ecotone</a></li><li class="chapter-item expanded "><a href="../fjord/overview.html"><strong aria-hidden="true">3.1.5.</strong> Fjord</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../fjord/exec-engine.html"><strong aria-hidden="true">3.1.5.1.</strong> Execution Engine</a></li><li class="chapter-item expanded "><a href="../fjord/derivation.html"><strong aria-hidden="true">3.1.5.2.</strong> Derivation</a></li><li class="chapter-item expanded "><a href="../fjord/predeploys.html"><strong aria-hidden="true">3.1.5.3.</strong> Predeploys</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../protocol/bridges.html"><strong aria-hidden="true">3.2.</strong> Bridges</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../protocol/messengers.html"><strong aria-hidden="true">3.2.1.</strong> Messengers</a></li><li class="chapter-item expanded "><a href="../protocol/deposits.html"><strong aria-hidden="true">3.2.2.</strong> Deposits</a></li><li class="chapter-item expanded "><a href="../protocol/withdrawals.html"><strong aria-hidden="true">3.2.3.</strong> Withdrawals</a></li><li class="chapter-item expanded "><a href="../protocol/guaranteed-gas-market.html"><strong aria-hidden="true">3.2.4.</strong> Guaranteed Gas Market</a></li><li class="chapter-item expanded "><a href="../protocol/proposals.html"><strong aria-hidden="true">3.2.5.</strong> Proposals</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.3.</strong> Clients</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../protocol/exec-engine.html"><strong aria-hidden="true">3.3.1.</strong> Execution Engine</a></li><li class="chapter-item expanded "><a href="../protocol/rollup-node.html"><strong aria-hidden="true">3.3.2.</strong> Rollup Node</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../protocol/rollup-node-p2p.html"><strong aria-hidden="true">3.3.2.1.</strong> Rollup Node P2P</a></li><li class="chapter-item expanded "><a href="../protocol/derivation.html"><strong aria-hidden="true">3.3.2.2.</strong> Derivation</a></li></ol></li><li class="chapter-item expanded "><a href="../protocol/batcher.html"><strong aria-hidden="true">3.3.3.</strong> Batch Submitter</a></li></ol></li><li class="chapter-item expanded "><a href="../fault-proof/index.html"><strong aria-hidden="true">3.4.</strong> Fault Proof</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../fault-proof/cannon-fault-proof-vm.html"><strong aria-hidden="true">3.4.1.</strong> Cannon Fault Proof VM</a></li><li class="chapter-item expanded "><a href="../fault-proof/stage-one/index.html"><strong aria-hidden="true">3.4.2.</strong> Stage One Decentralization</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../fault-proof/stage-one/dispute-game-interface.html"><strong aria-hidden="true">3.4.2.1.</strong> Dispute Game Interface</a></li><li class="chapter-item expanded "><a href="../fault-proof/stage-one/fault-dispute-game.html"><strong aria-hidden="true">3.4.2.2.</strong> Fault Dispute Game</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../fault-proof/stage-one/honest-challenger-fdg.html"><strong aria-hidden="true">3.4.2.2.1.</strong> Honest Challenger</a></li><li class="chapter-item expanded "><a href="../fault-proof/stage-one/bond-incentives.html"><strong aria-hidden="true">3.4.2.2.2.</strong> Bond Incentives</a></li></ol></li><li class="chapter-item expanded "><a href="../fault-proof/stage-one/bridge-integration.html"><strong aria-hidden="true">3.4.2.3.</strong> Bridge Integration</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../protocol/precompiles.html"><strong aria-hidden="true">3.5.</strong> Precompiles</a></li><li class="chapter-item expanded "><a href="../protocol/predeploys.html"><strong aria-hidden="true">3.6.</strong> Predeploys</a></li><li class="chapter-item expanded "><a href="../protocol/preinstalls.html"><strong aria-hidden="true">3.7.</strong> Preinstalls</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.8.</strong> Superchain</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../protocol/superchain-configuration.html"><strong aria-hidden="true">3.8.1.</strong> Superchain Configuration</a></li><li class="chapter-item expanded "><a href="../protocol/superchain-upgrades.html"><strong aria-hidden="true">3.8.2.</strong> Superchain Upgrades</a></li></ol></li><li class="chapter-item expanded "><a href="../protocol/system-config.html"><strong aria-hidden="true">3.9.</strong> System Config</a></li><li class="chapter-item expanded "><a href="../protocol/configurability.html"><strong aria-hidden="true">3.10.</strong> Configurability</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.</strong> Experimental</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../experimental/custom-gas-token.html"><strong aria-hidden="true">4.1.</strong> Custom Gas Token</a></li><li class="chapter-item expanded "><a href="../experimental/alt-da.html"><strong aria-hidden="true">4.2.</strong> Alt-DA</a></li><li class="chapter-item expanded "><a href="../interop/overview.html"><strong aria-hidden="true">4.3.</strong> Interoperability</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../interop/dependency-set.html"><strong aria-hidden="true">4.3.1.</strong> Dependency Set</a></li><li class="chapter-item expanded "><a href="../interop/messaging.html"><strong aria-hidden="true">4.3.2.</strong> Messaging</a></li><li class="chapter-item expanded "><a href="../interop/predeploys.html"><strong aria-hidden="true">4.3.3.</strong> Predeploys</a></li><li class="chapter-item expanded "><a href="../interop/execution.html"><strong aria-hidden="true">4.3.4.</strong> Execution</a></li><li class="chapter-item expanded "><a href="../interop/sequencer.html"><strong aria-hidden="true">4.3.5.</strong> Sequencer</a></li><li class="chapter-item expanded "><a href="../interop/verifier.html"><strong aria-hidden="true">4.3.6.</strong> Verifier</a></li><li class="chapter-item expanded "><a href="../interop/rollup-node-p2p.html"><strong aria-hidden="true">4.3.7.</strong> Rollup Node P2P</a></li><li class="chapter-item expanded "><a href="../interop/fault-proof.html"><strong aria-hidden="true">4.3.8.</strong> Fault Proof</a></li><li class="chapter-item expanded "><a href="../interop/upgrade.html"><strong aria-hidden="true">4.3.9.</strong> Upgrade</a></li><li class="chapter-item expanded "><a href="../interop/token-bridging.html" class="active"><strong aria-hidden="true">4.3.10.</strong> Token Bridging</a></li><li class="chapter-item expanded "><a href="../interop/superchain-weth.html"><strong aria-hidden="true">4.3.11.</strong> SuperchainWETH</a></li></ol></li><li class="chapter-item expanded "><a href="../experimental/security-council-safe.html"><strong aria-hidden="true">4.4.</strong> Security Council Safe</a></li><li class="chapter-item expanded "><a href="../experimental/op-stack-manager.html"><strong aria-hidden="true">4.5.</strong> OP Stack Manager</a></li></ol></li><li class="chapter-item expanded "><a href="../glossary.html"><strong aria-hidden="true">5.</strong> Glossary</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">OP Stack Specification</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/ethereum-optimism/specs" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/ethereum-optimism/specs/edit/main/specs/interop/token-bridging.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="token-bridging"><a class="header" href="#token-bridging">Token Bridging</a></h1>
<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<p><strong>Table of Contents</strong></p>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#interface">Interface</a>
<ul>
<li><a href="#functions">Functions</a>
<ul>
<li><a href="#senderc20"><code>sendERC20</code></a></li>
<li><a href="#relayerc20"><code>relayERC20</code></a></li>
</ul>
</li>
<li><a href="#events">Events</a>
<ul>
<li><a href="#senderc20"><code>SendERC20</code></a></li>
<li><a href="#relayerc20"><code>RelayERC20</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#diagram">Diagram</a></li>
<li><a href="#implementation">Implementation</a></li>
<li><a href="#invariants">Invariants</a></li>
<li><a href="#future-considerations">Future Considerations</a>
<ul>
<li><a href="#cross-chain-transferfrom">Cross Chain <code>transferFrom</code></a></li>
<li><a href="#concatenated-action">Concatenated Action</a></li>
</ul>
</li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>Without a standardized security model, bridged assets may not be fungible with each other.
The <code>SuperchainERC20</code> unifies ERC20 token bridging to make it fungible across the Superchain.
It builds on top of the messaging protocol, as the most trust minimized bridging solution.</p>
<p>Unlike other standards, such as <a href="https://www.xerc20.com/">xERC20</a>,
where users interact with a bridge possessing mint and burn
privileges on cross-chain enabled tokens, this approach allows users to call methods directly on the token contract.</p>
<h2 id="interface"><a class="header" href="#interface">Interface</a></h2>
<h3 id="functions"><a class="header" href="#functions">Functions</a></h3>
<p>The standard will build on top of ERC20 and include the following functions:</p>
<h4 id="senderc20"><a class="header" href="#senderc20"><code>sendERC20</code></a></h4>
<p>Transfer <code>_amount</code> amount of tokens to address <code>_to</code> in chain <code>_chainId</code>.</p>
<p>It SHOULD burn <code>_amount</code> tokens and initialize a message to the <code>L2ToL2CrossChainMessenger</code> to mint the <code>_amount</code>
in the target address <code>_to</code> at <code>_chainId</code> and emit the <code>SendERC20</code> event including the <code>msg.sender</code> as parameter.</p>
<pre><code class="language-solidity">sendERC20(address _to, uint256 _amount, uint256 _chainId)
</code></pre>
<h4 id="relayerc20"><a class="header" href="#relayerc20"><code>relayERC20</code></a></h4>
<p>Process incoming messages IF AND ONLY IF initiated
by the same contract (token) address on a different chain
and come from the <code>L2ToL2CrossChainMessenger</code> in the local chain.
It SHOULD mint <code>_amount</code> to address <code>_to</code>, as defined in <code>sendERC20</code>
and emit an event including the <code>_from</code> and chain id from the
<code>source</code> chain, where <code>_from</code> is the <code>msg.sender</code> of <code>sendERC20</code>.</p>
<pre><code class="language-solidity">relayERC20(address _from, address _to, uint256 _amount)
</code></pre>
<h3 id="events"><a class="header" href="#events">Events</a></h3>
<h4 id="senderc20-1"><a class="header" href="#senderc20-1"><code>SendERC20</code></a></h4>
<p>MUST trigger when a cross-chain transfer is initiated using <code>sendERC20</code>.</p>
<pre><code class="language-solidity">event SendERC20(address indexed from, address indexed to, uint256 amount, uint256 destination)
</code></pre>
<h4 id="relayerc20-1"><a class="header" href="#relayerc20-1"><code>RelayERC20</code></a></h4>
<p>MUST trigger when a cross-chain transfer is finalized using <code>relayERC20</code>.</p>
<pre><code class="language-solidity">event RelayERC20(address indexed from, address indexed to, uint256 amount, uint256 source);
</code></pre>
<h2 id="diagram"><a class="header" href="#diagram">Diagram</a></h2>
<p>The following diagram depicts a cross-chain transfer.</p>
<pre class="mermaid">sequenceDiagram
  participant from
  participant SuperERC20_A as SuperchainERC20 (Chain A)
  participant Messenger_A as L2ToL2CrossDomainMessenger (Chain A)
  participant Inbox as CrossL2Inbox
  participant Messenger_B as L2ToL2CrossDomainMessenger (Chain B)
  participant SuperERC20_B as SuperchainERC20 (Chain B)
  participant Recipient as to

  from-&gt;&gt;SuperERC20_A: sendERC20To(to, amount, chainID)
  SuperERC20_A-&gt;&gt;SuperERC20_A: burn(from, amount)
  SuperERC20_A-&gt;&gt;Messenger_A: sendMessage(chainId, message)
  SuperERC20_A--&gt;SuperERC20_A: emit SendERC20(from, to, amount, destination)
  Inbox-&gt;&gt;Messenger_B: relayMessage()
  Messenger_B-&gt;&gt;SuperERC20_B: relayERC20(from, to, amount)
  SuperERC20_B-&gt;&gt;SuperERC20_B: mint(to, amount)
  SuperERC20_B--&gt;SuperERC20_B: emit RelayERC20(from, to, amount, source)
</pre>
<h2 id="implementation"><a class="header" href="#implementation">Implementation</a></h2>
<p>An example implementation that depends on deterministic deployments across chains
for security is provided.
This construction builds on top of the <a href="./predeploys.html#l2tol2crossdomainmessenger">L2ToL2CrossDomainMessenger</a>
for both replay protection and domain binding.</p>
<pre><code class="language-solidity">function sendERC20(address _to, uint256 _amount, uint256 _chainId) public {
  _burn(msg.sender, _amount);
  bytes memory _message = abi.encodeCall(this.relayERC20, (msg.sender, _to, _amount));
  L2ToL2CrossDomainMessenger.sendMessage(_chainId, address(this), _message);
  emit SendERC20(msg.sender, _to, _amount, _chainId);
}

function relayERC20(address _from, address _to, uint256 _amount) external {
  require(msg.sender == address(L2ToL2CrossChainMessenger));
  require(L2ToL2CrossChainMessenger.crossDomainMessageSender() == address(this));
  uint256 _source = L2ToL2CrossChainMessenger.crossDomainMessageSource();

  _mint(_to, _amount);

  emit RelayERC20(_from, _to, _amount, _source);
}
</code></pre>
<h2 id="invariants"><a class="header" href="#invariants">Invariants</a></h2>
<p>Besides the ERC20 invariants, the SuperchainERC20 will require the following interop specific properties:</p>
<ul>
<li>Conservation of bridged <code>amount</code>: The minted <code>amount</code> in <code>relayERC20()</code> should match the <code>amount</code>
that was burnt in <code>sendERC20()</code>, as long as target chain has the initiating chain in the dependency set.
<ul>
<li>Corollary 1: Finalized cross-chain transactions will conserve the sum of <code>totalSupply</code>
and each user's balance for each chain in the Superchain.</li>
<li>Corollary 2: Each initiated but not finalized message (included in initiating chain but not yet in target chain)
will decrease the <code>totalSupply</code> and the initiating user balance precisely by the burnt <code>amount</code>.</li>
<li>Corollary 3: <code>SuperchainERC20s</code> should not charge a token fee or increase the balance when moving cross-chain.</li>
<li>Note: if the target chain is not in the initiating chain dependency set,
funds will be locked, similar to sending funds to the wrong address.
If the target chain includes it later, these could be unlocked.</li>
</ul>
</li>
<li>Freedom of movement: Users should be able to send and receive tokens in any target
chain with the initiating chain in its dependency set
using <code>sendERC20()</code> and <code>relayERC20()</code>, respectively.</li>
<li>Unique Messenger: The <code>sendERC20()</code> function must exclusively use the <code>L2toL2CrossDomainMessenger</code> for messaging.
Similarly, the <code>relayERC20()</code> function should only process messages originating from the <code>L2toL2CrossDomainMessenger</code>.
<ul>
<li>Corollary: xERC20 and other standards from third-party bridges should use different functions.</li>
</ul>
</li>
<li>Unique Address: The <code>sendERC20()</code> function must exclusively send a message
to the same address on the target chain.
Similarly, the <code>relayERC20()</code> function should only process messages originating from the same address.
<ul>
<li>Note: The Factory will ensure same address deployment.</li>
</ul>
</li>
<li>Locally initiated: The bridging action should be initialized
from the chain where funds are located only.
<ul>
<li>This is because the same address might correspond to different users cross-chain.
For example, two SAFEs with the same address in two chains might have different owners.
With the prospects of a smart wallet future, it is impossible to assume
there will be a way to distinguish EOAs from smart wallets.</li>
<li>A way to allow for remotely initiated bridging is to include remote approval,
i.e. approve a certain address in a certain chainId to spend local funds.</li>
</ul>
</li>
<li>Bridge Events:
<ul>
<li><code>sendERC20()</code> should emit a <code>SendERC20</code> event. `</li>
<li><code>relayERC20()</code> should emit a <code>RelayERC20</code> event.</li>
</ul>
</li>
</ul>
<h2 id="future-considerations"><a class="header" href="#future-considerations">Future Considerations</a></h2>
<h3 id="cross-chain-transferfrom"><a class="header" href="#cross-chain-transferfrom">Cross Chain <code>transferFrom</code></a></h3>
<p>In addition to standard locally initialized bridging,
it is possible to allow contracts to be cross-chain interoperable.
For example, a contract in chain A could send pre-approved funds
from a user in chain B to a contract in chain C.</p>
<p>For the moment, the standard will not include any specific functionality
to facilitate such an action and rely on the usage of <code>Permit2</code> like this:</p>
<pre class="mermaid">sequenceDiagram
  participant from
  participant Intermediate_A as Initiator
  participant Messenger_A as L2ToL2CrossDomainMessenger (Chain A)
  participant Inbox as CrossL2Inbox
  participant Messenger_B as L2ToL2CrossDomainMessenger (Chain B)
  participant Permit2
  participant SuperERC20_B as SuperchainERC20 (Chain B)
  participant Recipient as to

  from-&gt;&gt;Intermediate_A: remoteTransferFrom(..., token, to, chainId, msg, signature)
  Intermediate_A-&gt;&gt;Messenger_A: permit: sendMessage(chainId, message)
  Inbox-&gt;&gt;Messenger_B: permit: relayMessage()
  Messenger_B-&gt;&gt;Permit2: permitTransferFrom(msg, sig)
  Permit2-&gt;&gt;SuperERC20_B: transferFrom(from, to, amount)

</pre>
<p>If, at some point in the future, these actions were to be included in the standard,
a possible design could introduce a <code>remoteTransferFrom()</code> function.</p>
<h3 id="concatenated-action"><a class="header" href="#concatenated-action">Concatenated Action</a></h3>
<p>It is possible to have an additional input <code>bytes _data</code> in both <code>sendERC20()</code> and <code>relayERC20()</code> that would make an
additional call to the <code>_to</code> address.
This feature could be used for cross-chain concatenated actions,
i.e. bridge funds and then do X.</p>
<p>This vertical has much potential but can also be achieved outside the standard in the following way:</p>
<pre class="mermaid">sequenceDiagram
  participant from
  participant Intermediate_A as intermediate A
  participant SuperERC20_A as SuperERC20 (Chain A)
  participant Messenger_A as L2ToL2CrossDomainMessenger (Chain A)
  participant Inbox_B as CrossL2Inbox (Chain B)
  participant Messenger_B as L2ToL2CrossDomainMessenger (Chain B)
  participant SuperERC20_B as SuperERC20 (Chain B)

  from-&gt;&gt;Intermediate_A: sendWithData(data)
  Intermediate_A-&gt;&gt;SuperERC20_A: sendERC20(amount, chainId)
  SuperERC20_A-&gt;&gt;SuperERC20_A: burn(from, amount)
  SuperERC20_A-&gt;&gt;Messenger_A: sendMessage(chainId, message)
  Intermediate_A-&gt;&gt;Messenger_A: sendMessage(chainId, to, data)
  Inbox_B-&gt;&gt;Messenger_B: relayMessage(): transfer
  Messenger_B-&gt;&gt;SuperERC20_B: finalizeSendERC20(to, amount)
  SuperERC20_B-&gt;&gt;SuperERC20_B: mint(to, amount)
  Inbox_B-&gt;&gt;Messenger_B: relayMessage(): call
  Messenger_B-&gt;&gt;to: call(data)
</pre>
<p>Adding the call to the standard would remove the dependence on the sequencer regarding the proper tx ordering
at the sequencer level, but would also introduce more risk for cross-chain fund transferring,
as an incorrectly formatted call would burn funds in the initiating chain but would revert
in destination and could never be successfully replayed.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../interop/upgrade.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../interop/superchain-weth.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../interop/upgrade.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../interop/superchain-weth.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../specs/static/solidity.min.js"></script>
        <script src="../specs/static/mermaid.min.js"></script>
        <script src="../specs/static/mermaid-init.js"></script>


    </div>
    </body>
</html>
